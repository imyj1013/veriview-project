# AI Server 실행 및 문제 해결 안내서

## 1. 시스템 요구사항

### 1.1. 필수 DLL 파일 설치
프로젝트를 실행하기 위해서는 다음 DLL 파일이 필요합니다:
- `openblas.dll`
- `opencv_world410.dll`

이 파일들은 OpenFace 얼굴 분석 도구 실행에 필요합니다.

### 1.2. 설치 방법
1. **제공된 설치 스크립트 사용 (권장):**
   - `install_dll.bat` 스크립트를 **관리자 권한**으로 실행하세요.
   - 스크립트가 필요한 DLL 파일을 자동으로 시스템에 설치합니다.

2. **수동 설치:**
   - `ai_server\tools` 폴더에 있는 DLL 파일을 다음 위치 중 하나에 복사하세요:
     - `C:\Windows\System32` (시스템 전체 적용)
     - 프로젝트 루트 폴더 (프로젝트만 적용)

## 2. 서버 실행 방법

### 2.1. 실행 스크립트 설명
- `run.py`: 개발/테스트 환경을 위한 스크립트
  - `python run.py --mode test`: 테스트 모드로 실행
  - `python run.py --mode main`: 메인 모드로 실행

- `server_runner.py`: 프로덕션 환경 실행을 위한 스크립트
  - `python server_runner.py`: 모든 기능이 통합된 서버 실행

### 2.2. 권장 실행 방법
프로젝트 루트 폴더(`veriview-project`)에서 다음 명령을 실행하세요:

```bash
# 메인 모드로 실행 (일반적인 사용)
python ai_server/run.py --mode main

# 또는 테스트 모드로 실행 (개발/디버깅)
python ai_server/run.py --mode test

# 또는 프로덕션 환경에서 실행
python ai_server/server_runner.py
```

## 3. 문제 해결

### 3.1. DLL 오류 해결
DLL 오류가 발생하는 경우:
1. 이 파일(`INSTALL.md`)에 설명된 대로 DLL 파일을 설치하세요.
2. `install_dll.bat` 스크립트를 관리자 권한으로 실행하세요.
3. 설치 후 시스템을 재부팅하여 DLL 등록을 완료하세요.

### 3.2. 파일 접근 오류 해결
"다른 프로세스가 파일을 사용 중" 오류가 발생하는 경우:
1. **서버를 재시작하세요.**
2. 임시 파일이 제대로 삭제되지 않은 경우, 수동으로 `%TEMP%` 폴더에서 `tmp*.wav` 파일을 삭제하세요.
3. 임시 파일 경로를 고유한 이름으로 변경하는 것이 이미 적용되었습니다.

### 3.3. 인터뷰 질문 생성 오류
인터뷰 질문 생성이 실패하는 경우:
1. 서버 로그를 확인하여 정확한 오류 원인을 파악하세요.
2. API 엔드포인트가 `/ai/interview/generate-question`으로 올바르게 설정되어 있는지 확인하세요.

### 3.4. 기업공고 추천 기능 오류
404 오류가 발생하는 경우:
1. AI 서버가 실행 중인지 확인하세요.
2. 엔드포인트 `/ai/recruitment/posting`이 올바르게 설정되어 있는지 확인하세요.

## 4. 추가 참고사항
- 모든 서버(frontend, backend, ai_server)가 동시에 실행 중이어야 합니다.
- 각 서버의 기본 포트:
  - Frontend: 3000
  - Backend: 4000
  - AI Server: 5000

## 5. 추가 오류 상황 처리

### 5.1. 오디오 처리 오류
음성 분석 중 "not enough values to unpack (expected 2, got 1)" 오류가 발생하는 경우:

1. **이미 해결됨:** 개선된 오류 처리가 적용되어 기본값을 반환합니다.
2. **파일 형식 확인:** 비디오 파일이 올바른 형식인지 확인하세요(MP4, WEBM 등).
3. **임시 파일 삭제:** `%TEMP%` 폴더에서 기존 임시 오디오 파일을 삭제하세요.

### 5.2. OpenFace 실행 오류
지속적인 "OpenFace 실행 실패" 로그가 발생하는 경우:

1. **DLL 설치 확인:** DLL 파일이 올바른 위치에 설치되었는지 확인하세요.
2. **경로 확인:** OpenFace 실행 파일의 경로가 올바른지 확인하세요.
3. **테스트 모드:** 기본적으로 테스트 모드로 작동하므로 기능은 정상적으로 작동합니다.

위 수정으로 기본적인 오류는 해결되었지만, 실제 환경에서 추가 설정이 필요할 수 있습니다. 문제 발생 시 서버 로그를 확인하고 필요한 조치를 취하세요.
